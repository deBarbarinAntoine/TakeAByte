<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address and Delivery Point Finder</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Address and Delivery Point Finder</h1>
<div>
    <label for="addressInput">Enter Address:</label>
    <input type="text" id="addressInput" placeholder="Type an address">
    <button id="searchAddress">Search</button>
</div>
<div>
    <h2>Select Search Radius:</h2>
    <label><input type="radio" name="rayon" value="1000" checked> 1 km</label>
    <label><input type="radio" name="rayon" value="3000"> 3 km</label>
    <label><input type="radio" name="rayon" value="5000"> 5 km</label>
</div>
<div>
    <h2>Address Suggestions:</h2>
    <ul id="addressSuggestions"></ul>
</div>
<div>
    <h2>Close Delivery Points:</h2>
    <ul id="deliveryPoints"></ul>
</div>

<script>
    $(document).ready(function() {
        $('#searchAddress').click(function() {
            const address = $('#addressInput').val();
            if (address) {
                $.ajax({
                    url: `/getAddress/${address}`,
                    method: 'GET',
                    success: function(response) {
                        $('#addressSuggestions').empty();
                        response.suggestions.forEach(suggestion => {
                            const listItem = `<li>${suggestion.address}
                                    (Lat: ${suggestion.latitude}, Lon: ${suggestion.longitude})
                                    <button class="findDeliveryPoints" data-lat="${suggestion.latitude}" data-lon="${suggestion.longitude}">Find Delivery Points</button>
                                    </li>`;
                            $('#addressSuggestions').append(listItem);
                        });
                    },
                    error: function(error) {
                        console.error('Error fetching address suggestions:', error);
                    }
                });
            }
        });

        $(document).on('click', '.findDeliveryPoints', function() {
            const latitude = $(this).data('lat');
            const longitude = $(this).data('lon');
            const rayon = $('input[name="rayon"]:checked').val();
            if (latitude && longitude && rayon) {
                $.ajax({
                    url: `/getCloseDeliveryPoint/${rayon}/${latitude}/${longitude}`,
                    method: 'GET',
                    success: function(response) {
                        $('#deliveryPoints').empty();
                        response.deliveryPoints.forEach(point => {
                            const listItem = `<li>${point.name}
                                    (Lat: ${point.latitude}, Lon: ${point.longitude},
                                    Opening Hours: ${point.opening_hours || 'N/A'})</li>`;
                            console.log(response)
                            $('#deliveryPoints').append(listItem);
                        });
                    },
                    error: function(error) {
                        console.error('Error fetching delivery points:', error);
                    }
                });
            }
        });
    });
</script>
</body>
</html>
