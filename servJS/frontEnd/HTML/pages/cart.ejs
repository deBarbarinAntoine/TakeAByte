<div class="main">
    <div class="cart">
        <div class="cart-header">
            <div class="title">Your cart items</div>
            <a href="/home">Back to shopping</a>
        </div>

        <div class="cart-list">
            <div class="list-header">
                <span class="label-1">Products</span>
                <span class="label-2">Price</span>
                <span class="label-3">Quantity</span>
                <span class="label-4">Total</span>
            </div>
            <div class="separator"></div>
            <div class="products-list">

                <%################################################################################%>
                <%#     cart-product templates                                                    %>
                <%################################################################################%>
                <% data.cart.products.resultArray.forEach(function (product) { %>
                    <%- include('../partials/cart-product', {product: product}); %>
                <% }); %>
            </div>
            <div class="separator"></div>
            <div class="list-footer">
                <div class="cart-info">
                    <div class="subtotal">
                        <div class="title">Sub-total</div>
                        <div class="subtotal-nb"></div>
                    </div>
                    <div class="message">Shipping will be calculated later</div>
                </div>
                <a href="/order/address" class="button blue">Check-out</a>
            </div>
        </div>
    </div>
</div>
<script>
    // Select all elements with class "quantity"
    let quantityInputs = document.querySelectorAll('.quantity');
    // Select all div elements with class "product-total"
    let productTotalDivs = document.querySelectorAll('.product-total');
    // Select the div with class "subtotal-nb"
    let subtotalDiv = document.querySelector('.subtotal-nb');


    function updateSubtotal() {
        // Initialize sum variable
        let sum = 0;
    // Loop through each div element
    productTotalDivs.forEach(div => {
        // Get the content of the div and extract the number
        let textContent = div.textContent.trim();
        let numberStr = textContent.split(' ')[0]; // Get the number part before '€'
        let number = parseFloat(numberStr);

        // Check if the conversion was successful and add to sum
        if (!isNaN(number)) {
            sum += number;
        }
    });

    // Update the content of subtotalDiv with the calculated sum
    subtotalDiv.textContent = sum.toFixed(2) + ' €';
    }
    // Initial update
    updateSubtotal();

    // Function to handle click on quantity inputs
    function handleQuantityClick(event) {
        // Update subtotal whenever a quantity input is clicked
        updateSubtotal();
    }

    // Add click event listener to each quantity input
    quantityInputs.forEach(input => {
        input.addEventListener('click', handleQuantityClick);
    });
</script>

